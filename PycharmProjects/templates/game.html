<!DOCTYPE html>
<html lang="he">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>××©×—×§ ×™×•× ×”××”×‘×”ğŸ’–</title>


<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@500;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600;700&display=swap" rel="stylesheet">

<style>
*{ box-sizing:border-box; }

body{
  margin:0;
  padding:12px;
  font-family:'Fredoka','Varela Round','Comic Sans MS',sans-serif;
  direction:rtl;
  background:#ffb6c9;
  overflow-x:hidden;
  -webkit-tap-highlight-color: transparent;
}

img, object{
  max-width:100%;
  height:auto;
  display:block;
}

/* ===== ×¨×§×¢ GIF ×œ×‘×‘×•×ª ===== */
.gif-hearts-bg{
  position:fixed;
  inset:0;
  z-index:0;
  pointer-events:none;
  background-image:url("{{ url_for('static', filename='images/pulsing_heart.gif') }}");
  background-repeat:repeat;
  background-size:130px auto;
  opacity:0.4;
}

/* ===== ×œ×‘×‘×•×ª ×¦×¤×™× ===== */
.hearts-bg{
  position:fixed;
  inset:0;
  z-index:1;
  pointer-events:none;
  overflow:hidden;
}

.pixel-heart{
  position:absolute;
  bottom:-60px;
  width:28px;
  height:28px;
  opacity:0.85;
  animation: floatUp 18s linear infinite, pulse 1.4s ease-in-out infinite;
}

.pixel-heart img{
  width:100%;
  height:100%;
}

@keyframes floatUp{
  from{ transform:translateY(0); }
  to{ transform:translateY(-120vh); }
}

@keyframes pulse{
  0%,100%{ transform:scale(1); }
  50%{ transform:scale(1.4); }
}

/* ===== ×›×¨×˜×™×¡ ===== */
.card{
  position:relative;
  z-index:2;
  max-width:420px;
  width:100%;
  margin:auto;
  background:#ffe1ea;
  padding:16px;
  border-radius:20px;
  box-shadow:0 10px 30px rgba(0,0,0,0.15);
}

.center{ text-align:center; }

h1,h2,h3{
  color:#e84a7f;
  font-weight:700;
}

p{
  color:#e0638c;
  font-size:18px;
}

/* ===== ×›×¤×ª×•×¨×™× ×¨×’×™×œ×™× ===== */
button{
  background:#ff2f5e;
  color:white;
  font-size:18px;
  border:none;
  border-radius:999px;
  padding:12px 20px;
  min-height:48px;
  width:100%;
  max-width:320px;
  box-shadow:0 6px 0 #c4002d;
  cursor:pointer;
}

button:active{
  transform:translateY(4px);
  box-shadow:0 2px 0 #c4002d;
}

button + button{ margin-top:10px; }

input{
  width:100%;
  min-height:48px;
  padding:12px;
  font-size:18px;
  border-radius:999px;
  border:1px solid #ddd;
  text-align:center;
}

.balloon-btn{
  font-family: 'Baloo 2', 'Fredoka', sans-serif;
  font-size: 20px;
  letter-spacing: 1px;
}

/* ===== ×—×™×“×ª ×ª××•× ×•×ª ===== */
.pics{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:12px;
  margin-bottom:16px;
}

.pic-box{
  aspect-ratio:1/1;
  border-radius:16px;
  overflow:hidden;
  background:#fff;
  box-shadow:0 4px 10px rgba(0,0,0,0.15);
}

.pic-box img{
  width:100%;
  height:100%;
  object-fit:cover;
}

/* ===== ××¤×” SVG ===== */
.map-wrapper{
  position:relative;
  width:100%;
}

/* ===== ×›×¤×ª×•×¨×™ ××¤×” â€“ ×œ×‘ ===== */
.map-btn{
  position:absolute;
  width:34px;
  height:34px;
  background:none;
  border:none;
  padding:0;
  cursor:pointer;
}

.map-btn img{
  width:100%;
  height:100%;
  display:block;
}

.map-btn span{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  color:white;
  font-size:11px;
  font-weight:700;
  pointer-events:none;
}

.map-btn{
  background:transparent;
  outline:none;
  box-shadow:none;
}

.map-btn img{
  background:transparent;
}

/* ===== ×›×¤×ª×•×¨×™ ×ª××¨×™×š ===== */
.date-btn{
  width:80px;
  height:80px;
  border-radius:16px; /* ×¨×™×‘×•×¢ ×¢× ×¤×™× ×•×ª ×¨×›×•×ª */
  font-size:16px;
  font-weight:700;
  background:#ff5c8a;
  box-shadow:0 6px 0 #c4002d;
  display:flex;
  align-items:center;
  justify-content:center;
}

.date-grid{
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 12px;
}

.lock-overlay{
  position:fixed;
  inset:0;
  background:rgba(255,182,201,0.95);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:999;
}

.lock-overlay img{
  width:220px;
}

</style>
</head>

<body>

<!-- ğŸ’– ×¨×§×¢ GIF -->
<div class="gif-hearts-bg"></div>

<!-- ğŸ’• ×œ×‘×‘×•×ª ×¦×¤×™× -->
<div class="hearts-bg">
  {% for i in range(20) %}
    <span class="pixel-heart"
      style="left:{{ loop.index0 * 5 }}%; animation-delay: {{ loop.index0 * 0.6 }}s;">
      <img src="{{ url_for('static', filename='images/pixel_heart.png') }}">
    </span>
  {% endfor %}
</div>

<div class="card">

<h1 class="center">ğŸ’˜ × ×—×© ××ª ×”××ª× ×” ğŸ’˜</h1>

{% if message and step in [1,2,3,4,5] %}
<p class="center"><strong>{{ message }}</strong></p>
{% endif %}

{% if step == 0 %}
<div class="center">
  <h2>{{ welcome_text | safe }}</h2>
  <form method="post">
    <input type="hidden" name="action" value="start_game">
    <button class="balloon-btn">×”×ª×—×œğŸ’–</button>
  </form>
</div>

{% elif step == 0.5 %}
<div class="center">
  <h2>××™×š ××©×—×§×™×?ğŸ’˜</h2>
  <p>
    ×œ×¤× ×™×š 3 ×—×™×“×•×ª ×§×¦×¨×•×ª: ××ª××˜×™×ª, ×•×™×–×•××œ×™×ª ×•×˜×§×¡×˜×•××œ×™×ª, ×‘×›×œ ××—×ª ××”×Ÿ ×™×© ×œ×š 3 × ×™×¡×™×•× ×•×ª ×œ×¢× ×•×ª ×ª×©×•×‘×” × ×›×•× ×”ğŸ˜<br>
    ×›×œ ×—×™×“×” ××”×•×•×” ×¨××– ×œ××ª× ×ª ×™×•× ×”××”×‘×” ×©×œ×šğŸ’–<br><br>

    ×”×—×•×§ ×”×™×—×™×“: ××™×Ÿ ×”×ª×¢×¨×‘×•×ª ×©×œ×™, ×›×œ×•××¨, ×× ×œ× ×ª×¦×œ×™×— ×œ×’×œ×•×ª ×‘×¢×¦××š ×ª×¦×˜×¨×š ×œ×”×©××¨ ×‘×¡×™××Ÿ ×©××œ×”...<br>
    <br>×™×•× ××”×‘×” ×©××— ××”×•×‘ ×©×œ×™ğŸ˜‰
  </p>
  <form method="post">
    <button name="action" value="start_after_instructions" class="balloon-btn">
      ×™××œ×œ×”, ××ª×—×™×œ×™×ğŸˆ
    </button>
  </form>
</div>

{% elif step == 1 %}
<div class="center">
  <p><strong>
    ××›×™×•×•×Ÿ ×©××ª×” ×˜×•×¢×Ÿ ×©××ª×” ××•×”×‘ ××¡×¤×¨×™×, × ×ª×—×× ×‘×¢×–×¨×ª ×—×™×“×” ×¤×©×•×˜×”:<br>
    ××”×• ×”×§×•×“ ×œ×›×¡×¤×ª?
  </strong></p>
  <img src="{{ url_for('static', filename='images/math.png') }}">
  {% if not session.get('unlock_math') %}
  <form method="post">
    <input type="text" name="math_guess">
    <input type="hidden" name="action" value="math_submit">
    <button class="balloon-btn">×‘×“×•×§</button>
  </form>
  {% endif %}
</div>

{% if step == 1 and session.get('unlock_math') %}
<!-- ğŸ”“ OVERLAY -->
<div class="lock-overlay">
  <img src="{{ url_for('static', filename='images/lock.gif') }}">
</div>
<form method="post" id="autoContinue">
  <input type="hidden" name="action" value="continue_after_success">
</form>
<script>
  setTimeout(() => {
    document.getElementById("autoContinue").submit();
  }, 1800); // ××©×š ×”×’×™×£
</script>
{% endif %}

{% elif step == 2 %}
<div class="center map-wrapper">
  <p class="map-instructions">
  ×ª×—×‘×¨ (××• ×ª× ×—×©) ××ª ×”××¡×¤×¨×™× ×©××¦××ª ×‘×—×™×“×” ×”×§×•×“××ª.<br>
  </p>
  <img
  src="{{ url_for('static', filename='images/israel_map.svg') }}"
  alt="××¤×ª ×™×©×¨××œ"
  style="width:100%; height:auto;"
  >
  <form method="post" id="mapForm">
    <input type="hidden" name="map_choice" id="map_choice">
    <input type="hidden" name="action" value="map_pick">
  </form>

  {% for n,l,t in map_positions %}
    <button type="button"
      class="map-btn"
      style="left:{{ l }}; top:{{ t }};"
      onclick="
        document.getElementById('map_choice').value='{{ n }}';
        document.getElementById('mapForm').submit();
      ">
      <img src="{{ url_for('static', filename='images/heart_pin.png') }}">
      <span>{{ n }}</span>
    </button>
  {% endfor %}
</div>

{% elif step == 3 %}
<div class="center">
  <p class="pics-instructions">
  ×ª×”×™×” ×™×¦×™×¨×ª×™: ××” ××©×•×ª×£ ×œ×›×œ ×”×ª××•× ×•×ª?
  </p>
  <div class="pics">
    {% for img in pic_images %}
      <div class="pic-box">
        <img src="{{ url_for('static', filename='images/' + img) }}">
      </div>
    {% endfor %}
  </div>
  <form method="post">
    <input type="text" name="pic_guess">
    <input type="hidden" name="action" value="pic_submit">
    <button class="balloon-btn">×©×œ×—</button>
  </form>
</div>

{% elif step == 4 %}
<div class="center">
  <h3>×× ×™ ××ª×—×™×œ×” ×‘×“×¨×•×¨ ×•××¡×ª×™×™××ª ×‘×©×™×‘×”.<br>
××—×§ ××× ×™ ××ª ×¡×•×¤×™â€“ ×•××”×¤×•×š ×œ×¨×¢×™×•×Ÿ ××•×¤×©×˜,<br>
×”×•×¡×™×£ ×œ×™ ×™×•â€×“â€“ ×•××”×¤×•×š ×œ×ª×›×•× ×”.<br>
<br>
×›×©×ª×¤×’×•×© ×‘×™, ×¤× ×™×™×š ×™××—×§×• ××Ÿ ×”××¡×š,<br>
×•×× ×›×‘×¨ ××“×‘×¨×™×- ×§×“××” ×œ×™ ××¨×¥ ×©×œ××”, ××š ××™× ×™ ××§×•×.<br>
<br>
××”, ×•×× ×™ ×’× ××ª×—×™×œ×” ×××©×™×›×” ×•× ×’××¨×ª ×‘× ×—×™×¨×•×ª ×”× ×•×¨××™×•×ª ×©×œ×š.<br>
<br>
××™ ×× ×™?</h3>
  <form method="post">
    <input type="text" name="text_guess">
    <input type="hidden" name="action" value="text_submit">
    <button class="balloon-btn">×©×œ×—</button>
  </form>
</div>

{% elif step == 5 %}
<div class="center">
  <h3>×‘×•× × ×‘×—×Ÿ ××ª ×”×ª×—×•×©×•×ª ×‘×˜×Ÿ ×©×œ×š,<br>×ª×‘×—×¨ ×™×•×ğŸ’•</h3>

  {% set days = [
  ('×™×•× ×¨××©×•×Ÿ', 15),
  ('×™×•× ×©× ×™', 16),
  ('×™×•× ×©×œ×™×©×™', 17),
  ('×™×•× ×¨×‘×™×¢×™', 18),
  ('×™×•× ×—××™×©×™', 19),
  ('×™×•× ×©×™×©×™', 20),
  ('×™×•× ×©×‘×ª', 21)
  ] %}

  <div class="date-grid">
  {% for name, day in days %}
    <form method="post">
      <input type="hidden" name="action" value="date_pick">
      <input type="hidden" name="date_choice" value="2026-02-{{ day }}">
      <button class="date-btn">
        {{ name }}<br>{{ day }}/02
      </button>
    </form>
  {% endfor %}
  </div>
</div>


{% elif step == "failed" %}
<div class="center">
  <p><strong>{{ message }}</strong></p>
  <form method="post">
    <input type="hidden" name="action" value="continue_after_fail">
    <button class="balloon-btn">×”××©×š ×œ×—×™×“×” ×”×‘××”ğŸ’•</button>
  </form>
</div>

{% elif step == "success" %}
<div class="center">
  <p><strong>{{ message }}</strong></p>

  <form method="post">
    <input type="hidden" name="action" value="continue_after_success">
    <button class="balloon-btn">×”××©×š ×œ×—×™×“×” ×”×‘××” ğŸ’•</button>
  </form>
</div>

{% elif step == 999 %}
  {% if session.get('end_result') == "success" %}
  <div class="center">
    <h2>×‘××•×¤×Ÿ ××¤×ª×™×¢ ×¦×“×§×ª!</h2>
    <p>
      ×™×•×“×¢ ×›×‘×¨ ×œ× ×—×© ××” ××—×›×” ×œ×š?ğŸ<br>
    </p>
  </div>
  {% else %}
  <div class="center">
    <h2>×œ× ××¤×ª×™×¢... ×™× ×¨×§×•××Ÿ</h2>
    <p>
      ××•×× × ×œ× ×”×œ×š ×¢× ×”× ×™×—×•×©×™×,<br>
      ××‘×œ ×”×™×™- ×œ×¤×—×•×ª ××™×ª×™ ×¢×•×‘×“ ×œ×šğŸ˜‰ğŸ’•<br>
      ×× ×™ ××•×”×‘×ª ××•×ª×š ××××™ (××‘×œ ×¦×¤×” ×¤×’×™×¢×”ğŸ˜ˆ)
    </p>
  </div>
  {% endif %}
{% endif %}
</div>

</body>
</html>
